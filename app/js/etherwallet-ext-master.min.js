function checkAndLoadPageHash(){if(window.location.hash){var e=window.location.hash.substr(1);$(".ptabs").each(function(t){return $(this).attr("id")==e?($(this).click(),void setTimeout(function(){$("html,body").scrollTop(0)},50)):void 0})}}function paneNavigate(e,t){hideAllMainContainers(),$("#"+e).show(),$("#"+t).parent().addClass("active"),location.hash=t,onTabOpen(t),$("html,body").scrollTop(0)}function onTabOpen(e){"add-wallet"==e?setNickNames():"wallets"==e?reloadMainPageWallets():"send-transaction"==e&&setSendTransactionWallets()}function bindElements(){$(".ptabs").each(function(e){$(this).click(function(){paneNavigate($(this).attr("showId"),this.id)})}),$("#btndonate").click(function(){$("#sendtxaddress").val("0x7cb57b5a97eabe94205c07890be4c1ad31e486a8"),$("#donateThanks").show(),$("#sendtxaddress").trigger("keyup")}),$("#btngeneratetranaction").click(function(){preCreateTransaction()}),$("#btnapprovesend").click(function(){preSendTransaction()}),$("#decryptAddWallet").click(function(){addDecryptedWallet()}),$("#printqr").click(function(){printQRcode()}),$("#btnapproveEdit").click(function(){var e=$("#editWalletAddress").val(),t=$("#walletName").val();editNickName(e,t,function(){reloadMainPageWallets(),$("#walletName").val(""),$("#editWallet").modal("hide")})}),$("#hideWalletDetails").click(function(){$("#walletNickname").html(""),$("#address").val(""),$("#privkey").val(""),$("#privkeyenc").val(""),$("#qrcodeAdd").empty(),$("#viewWalletDiv").hide(),$("#qrcodeAdd").empty(),$("#qrcode").empty(),$("#encdownload").attr("href",""),$("#encdownload").attr("download",""),$("#unencdownload").attr("href",""),$("#unencdownload").attr("download","")}),$("#btnapproveView").click(function(){var e=$("#viewWalletAddress").val(),t=$("#viewWalletPin").val(),a=$("#walletNicknameView").html();$("#viewWalletPin").val(""),""==t?$("#viewWalletPopStatus").html(getErrorText("Please enter the pin of the wallet")).fadeIn(50).fadeOut(3e3):getWalletFromStorage(e,function(n){try{if(chrome.runtime.lastError)throw chrome.runtime.lastError.message;var r=JSON.parse(n[e]).priv,i=decryptTxtPrivKey(r,t);$("#walletNickname").html(a),$("#address").val(e),$("#privkey").val(i),$("#privkeyenc").val(r),$("#qrcodeAdd").empty(),$("#viewWalletDiv").show(),$("#qrcodeAdd").empty(),new QRCode($("#qrcodeAdd")[0],{text:e,width:$("#qrcode").width(),height:$("#qrcode").width(),colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}),$("#qrcode").empty(),new QRCode($("#qrcode")[0],{text:i,width:$("#qrcode").width(),height:$("#qrcode").width(),colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H});var l="text/json;charset=UTF-8",o=new Blob([JSON.stringify({address:e,encrypted:!0,locked:!0,"private":r,hash:e})],{type:l}),s=new Blob([JSON.stringify({address:e,encrypted:!0,locked:!1,"private":i,hash:e})],{type:l});$("#encdownload").attr("href",window.URL.createObjectURL(o)),$("#encdownload").attr("download",e+"-Encrypted.json"),$("#unencdownload").attr("href",window.URL.createObjectURL(s)),$("#unencdownload").attr("download",e+"-Unencrypted.json"),$("#viewWalletDetails").modal("hide")}catch(d){$("#viewWalletPopStatus").html(getErrorText("Invalid password ")).fadeIn(50).fadeOut(3e3)}})}),$("#btnapproveremove").click(function(){var e=$("#deleteWalletAddress").val();deleteAccount(e,function(){reloadMainPageWallets(),$("#removeWallet").modal("hide")})}),$("#transferAllBalance").click(function(){getMaxSendAmount($("#accountAddress1").html(),function(e){$("#sendtxamount").val(e),$("input[type=radio][name=currencyRadio][value=ether]").prop("checked",!0),$("#sendtxamount").trigger("keyup")},function(e){$("#txcreatestatus").html('<p class="text-center text-danger"><strong> '+e+"</strong></p>").fadeIn(50).fadeOut(3e3)})}),$("#decryptdata").click(function(){$("#decryptStatus").html('<p class="text-center text-info"><strong> Please Wait...</strong></p>').fadeIn(10),setTimeout(function(){decryptFormData()},100)}),$("#decryptSendTx").click(function(){$("#decryptStatusSendTx").html('<p class="text-center text-info"><strong> Please Wait...</strong></p>').fadeIn(10),setTimeout(function(){decryptSendTxData()},100)}),$("#generateNewWallet").click(function(){generateSingleWallet()}),$("input[type=radio][name=typeOfKeyRadio]").change(function(){PrivKey="",$("#fuploadStatus").empty(),$("#walletfilepassword").val(""),$("#privkeypassword").val(""),$(".btn-file :file").val(""),$("#manualprivkey").val(""),$("#walletuploadbutton").hide(),$("#walletPasdiv").hide(),$("#divprikeypassword").hide(),$("#addDecryptedWalletDiv").hide(),$("#decryptStatus").hide(),$("#selectedTypeKey").hide(),$("#selectedUploadKey").hide(),$("#selectedGenNewWallet").hide(),$("#newWalletGenButtonDiv").hide(),"fileupload"==this.value?($("#selectedUploadKey").show(),decryptType="fupload"):"pasteprivkey"==this.value?($("#selectedTypeKey").show(),decryptType="privkey"):"gennewwallet"==this.value&&($("#selectedGenNewWallet").show(),$("#newWalletGenButtonDiv").show(),decryptType="newwallet")}),$("input[type=radio][name=currencyRadio]").change(function(){$("#sendtxamount").trigger("keyup")}),$("#walletfilepassword").on("paste, keyup",function(){""!=$("#walletfilepassword").val()?($("#uploadbtntxt-wallet").show(),$("#uploadbtntxt-privkey").hide(),$("#walletuploadbutton").show()):$("#walletuploadbutton").hide()}),$("#sendtxamount").on("paste, keyup",function(){var e=$("#sendtxamount").val();if(""!=$("#sendtxamount").val()&&$.isNumeric(e)&&e>0){var t=$("input[type=radio][name=currencyRadio]:checked").val();$("#weiamount").html('<p class="text-success"><strong>'+toWei(e,t)+" wei ( approximately "+toFiat(e,t,usdval)+" USD/"+toFiat(e,t,eurval)+" EUR )</strong></p>")}else $("#weiamount").html(""==$("#sendtxamount").val()||$.isNumeric(e)?"":'<p class="text-danger"><strong>Invalid amount</strong></p>')}),$("#sendtxaddress").on("paste, keyup",function(){validateEtherAddress($("#sendtxaddress").val())?$("#addressvalidate").html('<p class="text-success"><strong> Address is valid</strong></p>').fadeIn(50):""==$("#sendtxaddress").val()?$("#addressvalidate").html(""):$("#addressvalidate").html('<p class="text-danger"><strong> Invalid address</strong></p>').fadeIn(50)}),$("#privkeypassword").on("paste, keyup",function(){$("#privkeypassword").val().length>6?($("#uploadbtntxt-wallet").hide(),$("#uploadbtntxt-privkey").show(),$("#walletuploadbutton").show()):$("#walletuploadbutton").hide()}),$("#manualprivkey").on("paste, keyup",function(){$("#divprikeypassword").hide(),$("#walletuploadbutton").hide(),$("#uploadbtntxt-wallet").hide(),$("#uploadbtntxt-privkey").hide(),$("#manualprivkey").val($("#manualprivkey").val().replace(/(?:\r\n|\r|\n| )/g,"")),128==$("#manualprivkey").val().length||132==$("#manualprivkey").val().length?$("#divprikeypassword").show():64==$("#manualprivkey").val().length&&($("#uploadbtntxt-wallet").hide(),$("#uploadbtntxt-privkey").show(),$("#walletuploadbutton").show())}),$(".btn-file :file").change(function(){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return void alert("The File APIs are not fully supported in this browser. Please use a modern browser");var e=$(this),t=e.get(0).files?e.get(0).files.length:1,a=e.val().replace(/\\/g,"/").replace(/.*\//,"");e.trigger("fileselect",[t,a])}),$(".btn-file :file").on("fileselect",function(e,t,a){$("#fuploadStatus").empty(),$("#walletfilepassword").val(""),PrivKey="",file=$(".btn-file :file")[0].files[0];var n=new FileReader;n.onload=function(){try{walletRequirePass(n.result)?($("#walletPasdiv").show(),$("#walletuploadbutton").hide()):($("#walletPasdiv").hide(),$("#walletuploadbutton").show(),$("#uploadbtntxt-wallet").show(),$("#uploadbtntxt-privkey").hide())}catch(e){$("#fuploadStatus").append('<p class="text-center text-danger"><strong> '+e+"</strong></p>")}},n.readAsText(file);var r=$(this).parents(".input-group").find(":text"),i=t>1?t+" files selected":a;r.length?r.val(i):i&&$("#fuploadStatus").append('<p class="text-center text-success"><strong> File Selected: '+i+"</strong></p>")})}function setNickNames(){getAllNickNames(function(e){SavedNickNames=e})}function preSendTransaction(){sendTransaction($("#tasignedtx").val(),function(e){$("#txsendstatus").html('<p class="text-center text-success"><strong> Transaction submitted. TX ID: '+e+"</strong></p>"),setWalletBalance(1)},function(e){$("#txsendstatus").html('<p class="text-center text-danger"><strong>'+e+"</strong></p>")}),$("#sendTransaction").modal("hide")}function preCreateTransaction(){try{$("#tarawtx").val(""),$("#tasignedtx").val(""),$("#txsendstatus").html("");var e=$("#sendtxaddress").val();if(64!=PrivKey.length)throw"Invalid Private key, try again";if(!validateEtherAddress(e))throw"Invalid to Address, try again";if(!$.isNumeric($("#sendtxamount").val())||$("#sendtxamount").val()<=0)throw"Invalid amount, try again";var t=$("input[type=radio][name=currencyRadio]:checked").val(),a=toWei($("#sendtxamount").val(),t);createTransaction(PrivKey,e,a,function(a){$("#tarawtx").val(a.raw),$("#tasignedtx").val(a.signed),$("#txcreatestatus").html('<p class="text-center text-success"><strong> Transaction generated</strong></p>').fadeIn(50),$("#divtransactionTAs").show(),$("#divsendtranaction").show(),$("#confirmAmount").html($("#sendtxamount").val()),$("#confirmCurrancy").html(t),$("#confirmAddress").html(e)},function(e){$("#txcreatestatus").html('<p class="text-center text-danger"><strong> '+e+"</strong></p>").fadeIn(50).fadeOut(3e3),$("#divtransactionTAs").hide(),$("#divsendtranaction").hide()})}catch(n){$("#txcreatestatus").html('<p class="text-center text-danger"><strong> '+n+"</strong></p>").fadeIn(50).fadeOut(3e3),$("#divtransactionTAs").hide(),$("#divsendtranaction").hide()}}function getErrorText(e){return'<p class="text-center text-danger"><strong> '+e+"</strong></p>"}function getSuccessText(e){return'<p class="text-center text-success"><strong> '+e+"</strong></p>"}function setSendTransactionWallets(){getWalletsArr(function(e){$("#tblsendtransactionWallets > tbody").empty();for(var t=0;t<e.length;t++){var a=e[t],n='<tr><td><label><input type="radio" name="selectedWallet" value="'+a.addr+'">'+a.nick+'</label></td><td id="walBalance-'+t+'">loading</td></tr>';$("#tblsendtransactionWallets > tbody").append(n),updateTableRowBalance(a.addr,"walBalance-"+t)}})}function reloadMainPageWallets(){getWalletsArr(function(e){$("#tblwalletsmain > tbody").empty();for(var t=0;t<e.length;t++){var a=e[t],n=getMainPageWalletRow(t+1,a.nick,a.addr);$("#tblwalletsmain > tbody").append(n),setWalletBalance("MainTbl-"+(t+1))}addEditEvents()})}function updateTableRowBalance(e,t){getBalance(e,function(e){if(!e.error){var a=getBestEtherKnownUnit(e.data.balance);$("#"+t).html(a.amount+" "+a.unit)}})}function addEditEvents(){$(".mainWalletEdit").unbind().click(function(){var e=$(this).attr("editval"),t=$("#accountNickMainTbl-"+e).html(),a=$("#accountAddressMainTbl-"+e).html();$("#walletNicknameEdit").html(t),$("#editWalletAddress").val(a),$("#editWallet").modal("show")}),$(".mainWalletDelete").unbind().click(function(){var e=$(this).attr("deleteVal"),t=$("#accountNickMainTbl-"+e).html(),a=$("#accountAddressMainTbl-"+e).html();$("#walletNicknameDelete").html(t),$("#deleteWalletAddress").val(a),$("#removeWallet").modal("show")}),$(".mainWalletView").unbind().click(function(){var e=$(this).attr("viewVal"),t=$("#accountNickMainTbl-"+e).html(),a=$("#accountAddressMainTbl-"+e).html();$("#walletNicknameView").html(t),$("#viewWalletAddress").val(a),$("#viewWalletDetails").modal("show")})}function setWalletBalance(e){getBalance($("#accountAddress"+e).html(),function(t){if(t.error)alert(t.msg);else{var a=getBestEtherKnownUnit(t.data.balance);$("#accountBalance"+e).html(a.amount+" "+a.unit),getETHvalue("USD",function(t){usdval=t,tusdval=toFiat(a.amount,a.unit,t),$("#accountBalanceUsd"+e).html(formatCurrency(parseFloat(tusdval),"$")+" USD")}),getETHvalue("EUR",function(t){eurval=t,teurval=toFiat(a.amount,a.unit,t),$("#accountBalanceEur"+e).html(formatCurrency(parseFloat(teurval),"&euro;")+" EUR")}),getETHvalue("BTC",function(t){btcval=t,tbtcval=toFiat(a.amount,a.unit,t),$("#accountBalanceBtc"+e).html(tbtcval+" BTC")})}})}function formatCurrency(e,t){return t+" "+e.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")}function walletDecryptSuccess(e){$("#accountAddress"+e).html(formatAddress(strPrivateKeyToAddress(PrivKey),"hex")),setWalletBalance(e),$("#decryptStatus"+e).html('<p class="text-center text-success"><strong> Wallet successfully decrypted</strong></p>').fadeIn(2e3),$("#walletpreview"+e).show()}function walletDecryptFailed(e,t){$("#decryptStatus"+e).html('<p class="text-center text-danger"><strong> '+t+"</strong></p>").fadeIn(50).fadeOut(3e3),$("#walletpreview"+e).hide()}function addDecryptedWallet(){var e=$("#decryptwalletpin").val(),t=stripScriptTags($("#decryptwalletnickname").val());if(""==e)$("#AddDecryptedWalletStatus").html(getErrorText("You must enter a PIN")).fadeIn(50).fadeOut(3e3);else if(e.length<8)$("#AddDecryptedWalletStatus").html(getErrorText("Your password must be at least 8 characters")).fadeIn(50).fadeOut(3e3);else if(""==t)$("#AddDecryptedWalletStatus").html(getErrorText("You must enter a nickname for your wallet")).fadeIn(50).fadeOut(3e3);else if($.inArray(t,SavedNickNames)>-1)$("#AddDecryptedWalletStatus").html(getErrorText("Nickname is in use, please select different nickname")).fadeIn(50).fadeOut(3e3);else if(""==PrivKey||64!=PrivKey.length)$("#AddDecryptedWalletStatus").html(getErrorText("Invalid Private key try to decrypt the wallet again")).fadeIn(50).fadeOut(3e3);else if(e==t)$("#generatedWallet").html(getErrorText("Password cannot be same as the the nickname")).fadeIn(50).fadeOut(3e3);else{var a=formatAddress(strPrivateKeyToAddress(PrivKey),"hex"),n=encryptPrivKey(PrivKey,e);addWalletToStorage(a,n,t,function(){chrome.runtime.lastError?$("#AddDecryptedWalletStatus").html(getErrorText(chrome.runtime.lastError.message)).fadeIn(50).fadeOut(3e3):($("#AddDecryptedWalletStatus").html(getSuccessText("New Wallet Generated! "+t+":"+a)).fadeIn(50).fadeOut(5e3),setNickNames())})}}function decryptFormData(){if(PrivKey="","fupload"==decryptType){file=$(".btn-file :file")[0].files[0];var e=new FileReader;e.onload=function(){try{PrivKey=getWalletFilePrivKey(e.result,$("#walletfilepassword").val()),walletDecryptSuccess(0)}catch(t){walletDecryptFailed(0,t)}},e.readAsText(file)}else if("privkey"==decryptType)try{PrivKey=decryptTxtPrivKey($("#manualprivkey").val(),$("#privkeypassword").val()),walletDecryptSuccess(0)}catch(t){walletDecryptFailed(0,"Invalid password")}}function decryptSendTxData(){var e=$("input[type=radio][name=selectedWallet]:checked").val(),t=$("#sendTransactionPin").val();""==e?$("#decryptStatus1").html(getErrorText("Please select a wallet")).fadeIn(50).fadeOut(3e3):""==t?$("#decryptStatus1").html(getErrorText("Please enter the pin of the wallet")).fadeIn(50).fadeOut(3e3):getWalletFromStorage(e,function(a){try{if(chrome.runtime.lastError)throw chrome.runtime.lastError.message;PrivKey=decryptTxtPrivKey(JSON.parse(a[e]).priv,t),walletDecryptSuccess(1)}catch(n){walletDecryptFailed(1,"Invalid password "+n)}})}function hideAllMainContainers(){$("#paneWallets").hide(),$("#paneAddWallet").hide(),$("#paneWalgen").hide(),$("#paneBulkgen").hide(),$("#paneSendTrans").hide(),$("#panePopContracts").hide(),$("#paneHelp").hide(),$("#paneContact").hide(),$("#panePrint").hide(),$("#wallets").parent().removeClass("active"),$("#add-wallet").parent().removeClass("active"),$("#bulk-generate").parent().removeClass("active"),$("#generate-wallet").parent().removeClass("active"),$("#send-transaction").parent().removeClass("active"),$("#popular-contracts").parent().removeClass("active"),$("#help").parent().removeClass("active"),$("#contact").parent().removeClass("active")}function generateSingleWallet(){var e=$("#ethgenpassword").val(),t=stripScriptTags($("#newWalletNick").val());if(""==e)$("#generatedWallet").html(getErrorText("You must enter a PIN.")).fadeIn(50).fadeOut(3e3);else if(e.length<8)$("#generatedWallet").html(getErrorText("Your password must be at least 8 characters.")).fadeIn(50).fadeOut(3e3);else if(""==t)$("#generatedWallet").html(getErrorText("You must enter a nickname for your wallet.")).fadeIn(50).fadeOut(3e3);else if($.inArray(t,SavedNickNames)>-1)$("#generatedWallet").html(getErrorText("Nickname is already in use. Please use different nickname.")).fadeIn(50).fadeOut(3e3);else if(e==t)$("#generatedWallet").html(getErrorText("Password cannot be same as the the nickname")).fadeIn(50).fadeOut(3e3);else{var a=new Accounts,n=a["new"](),r=n.address,i=encryptPrivKey(n["private"],e);addWalletToStorage(r,i,t,function(){chrome.runtime.lastError?$("#generatedWallet").html(getErrorText(chrome.runtime.lastError.message)).fadeIn(50).fadeOut(3e3):($("#generatedWallet").html(getSuccessText("New Wallet Generated! "+t+":"+r)).fadeIn(50).fadeOut(5e3),setNickNames(),$("#ethgenpassword").val(""),$("#newWalletNick").val(""),$('*[showid="paneWallets"]').click())}),a.clear()}}function stripScriptTags(e){for(var t=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;t.test(e);)e=e.replace(t,"");return e}function openPrintPaperWallets(e){var t=window.open("about:blank");data='<html>\r\n<head>\r\n  <link href="css/etherwallet-ext-master.min.css" rel="stylesheet" type="text/css">\r\n  <script src="js/jquery.js"></script>\r\n  <script src="js/etherwallet-ext-static.min.js"></script>\r\n  <script src="js/etherwallet-ext-master.min.js"></script>\r\n<script type="text/javascript">\r\nfunction generateWallets(){\r\n    var json = JSON.parse($("#printwalletjson").html());\r\n    for(var i=0;i<json.length;i++){\r\n        var walletTemplate = $(\'<div/>\').append($("#print-container").clone());\r\n        new QRCode($(walletTemplate).find("#paperwalletaddqr")[0], {\r\n		  text: json[i][\'address\'],\r\n		  colorDark: "#000000",\r\n		  colorLight: "#ffffff",\r\n		correctLevel: QRCode.CorrectLevel.H\r\n	   });\r\n       new QRCode($(walletTemplate).find("#paperwalletprivqr")[0], {\r\n		  text: json[i][\'private\'],\r\n		  colorDark: "#000000",\r\n		  colorLight: "#ffffff",\r\n		correctLevel: QRCode.CorrectLevel.H\r\n	   });\r\n       $(walletTemplate).find("#paperwalletadd").html(json[i][\'address\']);\r\n       $(walletTemplate).find("#paperwalletpriv").html(json[i][\'private\']);\r\n       walletTemplate = $(walletTemplate).find("#print-container").show();\r\n       $("body").append(walletTemplate);\r\n    }\r\n    setTimeout(function(){window.print();},2000);\r\n}\r\n</script>\r\n</head>\r\n<body>\r\n<span id="printwalletjson" style="display: none;">{{WALLETJSON}}</span>\r\n<div class="print-container" style="display: none; margin-bottom: 28px;" id="print-container">\r\n        <img src="images/logo-1.png" class="ether-logo-1" height="100%" width="auto"/>\r\n        <img src="images/logo-2.png" class="ether-logo-2"/>\r\n        <img src="images/ether-title.png" height="100%" width="auto" class="print-title"/>\r\n          <div class="print-qr-code-1">\r\n          <div id="paperwalletaddqr"></div>\r\n            <p class="print-text" style="padding-top: 25px;">YOUR ADDRESS</p>\r\n          </div>\r\n          <div class="print-qr-code-2">\r\n            <div id="paperwalletprivqr"></div>\r\n            <p class="print-text" style="padding-top: 30px;">YOUR PRIVATE KEY</p>\r\n          </div>\r\n          <div class="print-notes">\r\n            <img src="images/notes-bg.png" width="90%;" height="auto" class="pull-left" />\r\n            <p class="print-text">AMOUNT / NOTES</p>\r\n          </div>\r\n        <div class="print-address-container">\r\n          <p>\r\n            <strong>Your Address:</strong><br />\r\n            <span id="paperwalletadd"></span>\r\n          </p>\r\n          <p>\r\n            <strong>Your Private Key:</strong><br />\r\n            <span id="paperwalletpriv"></span>\r\n        </p>\r\n    </div>\r\n</div>\r\n</body>\r\n</html>',data=data.replace("{{WALLETJSON}}",e),$(t).ready(function(){t.document.write(data),t.document.write("<script>generateWallets();</script>")})}function printQRcode(){var e=$("#address").val(),t=$("#privkey").val(),a=[];a.push({address:e,"private":t}),openPrintPaperWallets(JSON.stringify(a))}function getBalance(e,t){$.post(SERVERURL,{balance:e}).done(t)}function getTransactionData(e,t){$.post(SERVERURL,{txdata:e}).done(t)}function sendRawTx(e,t){$.post(SERVERURL,{rawtx:e}).done(t)}function getEstimatedGas(e,t){$.post(SERVERURL,{estimatedGas:e}).done(t)}function getEthCall(e,t){$.post(SERVERURL,{ethCall:e}).done(t)}function getETHvalueKraken(e,t){var a="XETH";$.post(KRAKENAPI+"Ticker",{pair:a+e}).done(function(n){t(n.result[a+e].o)})}function getETHvalue(e,t){var a="eth";e=e.toLowerCase(),$.get(COINMARKETCAPAPI+a,function(a){t(parseFloat(a.price[e]).toFixed(6))})}function createTransaction(e,t,a,n,r){if(64!=e.length)return void r("Invalid Private Key. Please try again.");if(!validateEtherAddress(t))return void r("Invalid to Address. Please try again.");if(!$.isNumeric(a)||0>=a)return void r("Invalid Amount. Please try again.");var i=new Buffer(e,"hex"),l=strPrivateKeyToAddress(e);getTransactionData(l,function(e){if(e.error)return void r("Whoops. There was an error: "+e.msg);e=e.data;var l=padLeftEven(BNtoHex(new BigNumber(e.nonce))),o=padLeftEven(BNtoHex(new BigNumber(e.gasprice).plus(1e9).toDigits(1))),s=padLeftEven(BNtoHex(new BigNumber(stdTransactionGas))),d=padLeftEven(BNtoHex(new BigNumber(String(a)))),c={nonce:"0x"+l,gasPrice:"0x"+o,gasLimit:"0x"+s,to:t,value:"0x"+d,data:""},p=new Tx(c);p.sign(i),verifyUpFrontCost(c,function(t){if(t>e.balance)return void r("Whoops. You don't have enough balance in your account to process this transaction");var a="0x"+p.serialize().toString("hex"),i={raw:JSON.stringify(c),signed:a};n(i)},r)})}function createTransactionFromRaw(e,t,a,n){if(64!=t.length)return void n("Invalid Private Key. Please try again.");if(!validateEtherAddress(e.from)||!validateEtherAddress(e.to))return void n("Invalid Address. Please try again.");if(!$.isNumeric(e.value)||e.value<=0)return void n("Invalid amount. Please try again.");var r=new Buffer(t,"hex"),i=strPrivateKeyToAddress(t);getTransactionData(i,function(t){if(t.error)return void n("Whoops. There was an error: "+t.msg);t=t.data;var i=padLeftEven(BNtoHex(new BigNumber(t.nonce))),l=padLeftEven(BNtoHex(new BigNumber(t.gasprice).plus(1e9).toDigits(1))),o=padLeftEven(BNtoHex(new BigNumber(e.gas))),s=padLeftEven(BNtoHex(new BigNumber(String(e.value)))),d={nonce:"0x"+i,gasPrice:"0x"+l,gasLimit:"0x"+o,to:e.to,value:"0x"+s,data:"0x"+e.data},c=new Tx(d);c.sign(r),verifyUpFrontCost(d,function(e){if(e>t.balance)return void n("There is not enough balance in your account to process is transaction.");var r="0x"+c.serialize().toString("hex"),i={raw:JSON.stringify(d),signed:r};a(i)},n)})}function verifyUpFrontCost(e,t,a){getEstimatedGas(e,function(n){if(n.error)a("Whoops. There was an error: "+n.msg);else if(new BigNumber(formatHexString(n.data,"hex")).greaterThan(new BigNumber(formatHexString(e.gasLimit,"hex"))))a("Gas limit is too low");else{var r=new BigNumber(formatHexString(e.gasPrice,"hex")).times(new BigNumber(formatHexString(e.gasLimit,"hex")));t(r.plus(new BigNumber(formatHexString(e.value,"hex"))).toNumber())}})}function getMaxSendAmount(e,t,a){getTransactionData(e,function(e){if(e.error)return void a("Whoops. There was an error: "+e.msg);e=e.data;var n=new BigNumber(e.gasprice).plus(1e9).toDigits(1).times(stdTransactionGas),r=new BigNumber(String(e.balance)).minus(n);r.lessThan(0)?a("There is not enough balance in your account to process is transaction."):t(toEther(r.toString(),"wei"))})}function sendTransaction(e,t,a){sendRawTx(e,function(e){return e.error?void a("Whoops. There was an error: "+e.msg):void t(e.data)})}function BNtoHex(e){return e.toString(16)}function padLeftEven(e){return e.length%2!=0?"0"+e:e}function formatHexString(e,t){return"hex"==t?"0x"==e.substring(0,2)?e:"0x"+e:"raw"==t?"0x"==e.substring(0,2)?e.substring(2):e:void 0}function fiatToWei(e,t){var a=new BigNumber(String(e)).div(t).times(getValueOfUnit("ether")).round(0);return a.toString(10)}function toFiat(e,t,a){var n=new BigNumber(toEther(e,t)).times(a).round(5);return n.toString(10)}function toEther(e,t){var a=new BigNumber(toWei(e,t)).div(getValueOfUnit("ether"));return a.toString(10)}function toWei(e,t){var a=new BigNumber(String(e)).times(getValueOfUnit(t));return a.toString(10)}function getValueOfUnit(e){e=e?e.toLowerCase():"ether";var t=unitMap[e];if(void 0===t)throw new Error("This unit doesn't exist. Please use the one of the following units"+JSON.stringify(unitMap,null,2));return new BigNumber(t,10)}function getBestEtherKnownUnit(e){e=String(e);var t="wei",a=new BigNumber(e);for(var n in knownUnitMap)knownUnitMap.hasOwnProperty(n)&&new BigNumber(e).greaterThan(new BigNumber(knownUnitMap[n]))&&(t=n,a=new BigNumber(e).div(new BigNumber(knownUnitMap[n])));return{unit:t,amount:a.toDigits(10).toString(10)}}function decryptPresaleKey(e,t){e=JSON.parse(e);var a=hexToBytes(e.encseed),n=hexToCryptoJS(bytesToHex(a.slice(0,16))),r=hexToCryptoJS(bytesToHex(a.slice(16))),i=sha256.pbkdf2(stringToBytes(t),stringToBytes(t),2e3,16),l=hexToBytes(bytesToHex(i)).slice(0,16),o=CryptoJS.AES.decrypt({ciphertext:r},hexToCryptoJS(bytesToHex(l)),{iv:n,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}),s=cryptoJSToHex(o);o=hex2str(s);var d=CryptoJS.SHA3(o,{outputLength:256}),c=d.toString();if(verifyPrivKey(c,e.ethaddr))return c;throw"Invalid Password"}function decryptGethKeyV3(e,t){e=JSON.parse(e),null==e.Crypto&&null!=e.crypto&&(e.Crypto=e.crypto);var a=e.Crypto.cipherparams.iv,n=e.Crypto.ciphertext,r=getKDFKey(e.Crypto,t),i=hexToBytes(bytesToHex(r)).slice(0,16),l=CryptoJS.AES.decrypt({ciphertext:hexToCryptoJS(n)},hexToCryptoJS(bytesToHex(i)),{mode:CryptoJS.mode.CTR,padding:CryptoJS.pad.ZeroPadding,iv:hexToCryptoJS(a)}),o=cryptoJSToHex(l);if(verifyPrivKey(o,e.address))return o;throw"Invalid Password"}function decryptTxtPrivKey(e,t){if(128==e.length)var a=CryptoJS.AES.decrypt(e,t),n=hex2str(cryptoJSToHex(a));else if(132==e.length){var a=CryptoJS.AES.decrypt(e.substr(0,128),t),n=hex2str(cryptoJSToHex(a)),r=e.substr(e.length-4),i=formatAddress(strPrivateKeyToAddress(n),"hex"),l=cryptoJSToHex(CryptoJS.SHA3(i));if(l.substr(l.length-4)!=r)throw"Invalid Password. Please try again."}else{if(64!=e.length)throw"Error while decrypting your wallet";var n=e}return n}function encryptPrivKey(e,t){var a=formatAddress(strPrivateKeyToAddress(e),"hex"),n=cryptoJSToHex(CryptoJS.SHA3(a));return n=n.substr(n.length-4),e=CryptoJS.AES.encrypt(e,t).toString(),e+=n}function decryptEthWalletJson(e,t){if(e=JSON.parse(e),e.locked&&128==e["private"].length)var a=CryptoJS.AES.decrypt(e["private"],t),n=hex2str(cryptoJSToHex(a));else if(e.locked&&132==e["private"].length)var a=CryptoJS.AES.decrypt(e["private"].substr(0,128),t),n=hex2str(cryptoJSToHex(a));else{if(e.locked||64!=e["private"].length)throw"Error while decrypting your wallet";var n=e["private"]}if(verifyPrivKey(n,formatAddress(e.address,"raw")))return n;throw"Invalid Password. Please try again."}function walletRequirePass(e){var t;try{t=JSON.parse(e)}catch(a){throw"not a valid wallet file"}if(null!=t.encseed)return!0;if(null!=t.Crypto||null!=t.crypto)return!0;if(null!=t.hash&&t.locked)return!0;if(null==t.hash||t.locked)throw"Sorry! We don't recognize that type of wallet file. Please try again.";return!1}function verifyPrivKey(e,t){return 64!=e.length?!1:strPrivateKeyToAddress(e)!=t?!1:!0}function getWalletFilePrivKey(e,t){var a=JSON.parse(e);if(null!=a.encseed)return decryptPresaleKey(e,t);if(null!=a.Crypto||null!=a.crypto)return decryptGethKeyV3(e,t);if(null!=a.hash)return decryptEthWalletJson(e,t);throw"Sorry! We don't recognize that type of wallet file. Please try again."}function formatAddress(e,t){return"0x"==e.substr(0,2)&&"raw"==t&&(e=e.substr(2)),"0x"!=e.substr(0,2)&&"hex"==t&&(e="0x"+e),e}function strPrivateKeyToAddress(e){var t=ethUtil.privateToPublic(hexToBytes(e));return ethUtil.publicToAddress(t).toString("hex")}function getKDFKey(e,t){var a=hexToBytes(e.kdfparams.salt),n=stringToBytes(t),r=e.kdfparams.dklen;if("scrypt"==e.kdf){var i=e.kdfparams.n,l=e.kdfparams.r,o=e.kdfparams.p,s=scrypt_module_factory(335544320);return s.crypto_scrypt(n,a,i,l,o,r)}if("pbkdf2"==e.kdf){var d=e.kdfparams.c,c=(e.kdfparams.prf,sha256.pbkdf2(stringToBytes(t),hexToBytes(e.kdfparams.salt),d,r));return c}}function hexToCryptoJS(e){return CryptoJS.enc.Hex.parse(e)}function cryptoJSToHex(e){return CryptoJS.enc.Hex.stringify(e)}function validateEtherAddress(e){return 42==e.length&&"0x"==e.substr(0,2)&&/^[0-9A-F]+$/i.test(e.substr(2))}function hex2str(e){for(var e=e.toString(),t="",a=0;a<e.length;a+=2)t+=String.fromCharCode(parseInt(e.substr(a,2),16));return t}function bytesToHex(e){for(var t=[],a=0;a<e.length;a++)t.push((e[a]>>>4).toString(16)),t.push((15&e[a]).toString(16));return t.join("")}function hexToBytes(e){for(var t=[],a=0;a<e.length;a+=2)t.push(parseInt(e.substr(a,2),16));return t}function stringToBytes(e){for(var t=[],a=0;a<e.length;++a)t.push(e.charCodeAt(a));return t}function getAllNickNames(e){var t=[];storage.get(null,function(a){for(var n in a)if(a.hasOwnProperty(n)){var r=JSON.parse(a[n]);"wallet"==r.type&&t.push(r.nick)}e(t)})}function addWalletToStorage(e,t,a,n){a=a.replace(/(<([^>]+)>)/gi,"");var r={nick:a,priv:t,type:"wallet"},i=e,l={};l[i]=JSON.stringify(r),storage.set(l,n)}function getWalletFromStorage(e,t){storage.get(e,t)}function getWalletsArr(e){var t=[];storage.get(null,function(a){for(var n in a)if(a.hasOwnProperty(n)){var r=JSON.parse(a[n]);"wallet"==r.type&&(r.addr=n,t.push(r))}t.sort(sortByNickName),e(t)})}function deleteAccount(e,t){storage.remove(e,function(){t(e)})}function editNickName(e,t,a){t=t.replace(/(<([^>]+)>)/gi,""),storage.get(e,function(n){var r=n[e];r=JSON.parse(r),r.nick=t,n[e]=JSON.stringify(r),storage.set(n,function(){a(t)})})}function sortByNickName(e,t){return e.nick<t.nick?-1:e.nick>t.nick?1:0}function getMainPageWalletRow(e,t,a){var n="<tr>\r\n              <td>"+e+'</td>\r\n              <td id="accountNickMainTbl-'+e+'">'+t+'</td>\r\n              <td id="accountAddressMainTbl-'+e+'">'+a+'</td>\r\n              <td>\r\n                <strong class="text-success" id="accountBalanceMainTbl-'+e+'"></strong>\r\n                <br />\r\n                <small><span id="accountBalanceBtcMainTbl-'+e+'"></span> &nbsp;&nbsp; <span id="accountBalanceUsdMainTbl-'+e+'"></span> &nbsp;&nbsp; <span id="accountBalanceEurMainTbl-'+e+"\"></span></small>\r\n              </td>\r\n              <td> <a editVal='"+e+"' class='mainWalletEdit'> Edit </a></td>\r\n              <td> <a viewVal='"+e+"' class='text-warning mainWalletView'> View Wallet Details </a></td>\r\n              <td> <a deleteVal='"+e+"' class='mainWalletDelete' class=\"text-danger\"> Remove </a></td>\r\n            </tr>";return n}function getAccountInfoRow(e,t,a){var n="<tr>\r\n        <td>\r\n        <div style='display:none;' id='accountAddressPopMB-"+e+"'>"+t+"</div>\r\n          <label>"+a+"</label>\r\n        </td>\r\n        <td id='accountBalancePopMB-"+e+"'></td>\r\n      </tr>";return n}function getQuickSendRow(e,t,a){var n="<tr>\r\n        <td>\r\n        <div style='display:none;' id='accountAddressPopMB-"+e+"'>"+t+'</div>\r\n          <label><label><input type="radio" name="selectedWallet" value="'+t+'">'+a+"</label>\r\n        </td>\r\n        <td id='accountBalancePopMB-"+e+"'></td>\r\n      </tr>";return n}function pageBasedOnLoads(){$("#popupMainAccountTbl").length&&(reloadPopupAccounts(),$("#popupConfirmSend").hide())}function bindPopElements(){$("#popPreSend").click(function(){try{var e=$("input[name=selectedWallet]:checked").val(),t=$("#sendtxaddress").val(),a=$("#sendtxamount").val();if("undefined"==typeof e)throw"Whoops. An account was not selected.";if(!validateEtherAddress(t))throw"Invalid To: Address. Please check the address and try again.";if(!$.isNumeric(a)||0>=a)throw"Invalid Amount. Please try again.";

{var n=$("input[type=radio][name=currencyRadio]:checked").val();toWei(a,n)}$("#confirmAmount").html(a),$("#confirmCurrancy").html(n),$("#confirmAddress").html(t),$("#popupConfirmSend").show(),$("#sendTransMain").hide()}catch(r){$("#popwalletselectstatus").html('<p class="text-center text-danger"><strong> '+r+"</strong></p>").fadeIn(50).fadeOut(3e3)}}),$("#transferAllBalancePop").click(function(){var e=$("input[name=selectedWallet]:checked").val();return $("#sendtxamount").val(""),"undefined"==typeof e?void $("#popwalletselectstatus").html('<p class="text-center text-danger"><strong>No account selected</strong></p>').fadeIn(50).fadeOut(3e3):void getMaxSendAmount(e,function(e){$("#sendtxamount").val(e),$("input[type=radio][name=currencyRadio][value=ether]").prop("checked",!0),$("#sendtxamount").trigger("keyup")},function(e){$("#popwalletselectstatus").html('<p class="text-center text-danger"><strong> '+e+"</strong></p>").fadeIn(50).fadeOut(3e3)})}),$("#cancelTransaction").click(function(){$("#popupConfirmSend").hide(),$("#sendTransMain").show()}),$("#approveTransaction").click(function(){decryptAndSendTx()})}function decryptAndSendTx(){var e=$("input[type=radio][name=selectedWallet]:checked").val(),t=$("#sendTransactionPin").val();""==e?$("#decryptStatus1").html(getErrorText("Please select a wallet.")).fadeIn(50).fadeOut(3e3):""==t?$("#decryptStatus1").html(getErrorText("Please enter the pin of the wallet.")).fadeIn(50).fadeOut(3e3):getWalletFromStorage(e,function(a){try{if(chrome.runtime.lastError)throw chrome.runtime.lastError.message;PrivKey=decryptTxtPrivKey(JSON.parse(a[e]).priv,t);var n=$("#sendtxaddress").val(),r=$("#sendtxamount").val(),i=$("input[type=radio][name=currencyRadio]:checked").val(),l=toWei(r,i);createTransaction(PrivKey,n,l,function(e){var t=e.signed;sendTransaction(t,function(e){$("#decryptStatus1").html('<p class="text-center text-success"><strong> Success! Transaction submitted. TX ID: '+e+"</strong></p>").fadeIn(50).fadeOut(3e3,function(){location.reload()})},function(e){$("#decryptStatus1").html('<p class="text-center text-danger"><strong>'+e+"</strong></p>").fadeIn(50).fadeOut(3e3)})},function(e){$("#decryptStatus1").html('<p class="text-center text-danger"><strong> '+e+"</strong></p>").fadeIn(50).fadeOut(3e3)})}catch(o){walletDecryptFailed(1,"Invalid Password "+o)}})}function reloadPopupAccounts(){getWalletsArr(function(e){$("#popupMainAccountTbl > tbody").empty();for(var t=0;t<e.length;t++){var a=e[t];if($(".quicksend").length)var n=getQuickSendRow(t,a.addr,a.nick);else if($(".donate").length)var n=getQuickSendRow(t,a.addr,a.nick);else if($(".bAction").length)var n=getAccountInfoRow(t,a.addr,a.nick);$("#popupMainAccountTbl > tbody").append(n),setWalletBalance("PopMB-"+t)}0==e.length&&$("#popupMainAccountTbl > tbody").append('<tr><td colspan="2">You don\'t have any wallets saved yet! Click the <a class="text-primary" href="/wallet.html#add-wallet" target="_blank">"Add Wallet"</a> button to add one!</td></tr>')})}var PrivKey="",decryptType="",SavedNickNames=[],usdval,eurval,btcval;$(document).ready(function(){bindElements(),checkAndLoadPageHash()});var SERVERURL="https://rpc.myetherwallet.com/api.php",KRAKENAPI="https://api.kraken.com/0/public/",COINMARKETCAPAPI="https://coinmarketcap-nexuist.rhcloud.com/api/",stdTransactionGas=21e3,knownUnitMap={wei:"1",kwei:"1000",gwei:"1000000000",szabo:"1000000000000",finney:"1000000000000000",ether:"1000000000000000000"},unitMap={wei:"1",kwei:"1000",ada:"1000",femtoether:"1000",mwei:"1000000",babbage:"1000000",picoether:"1000000",gwei:"1000000000",shannon:"1000000000",nanoether:"1000000000",nano:"1000000000",szabo:"1000000000000",microether:"1000000000000",micro:"1000000000000",finney:"1000000000000000",milliether:"1000000000000000",milli:"1000000000000000",ether:"1000000000000000000",kether:"1000000000000000000000",grand:"1000000000000000000000",einstein:"1000000000000000000000",mether:"1000000000000000000000000",gether:"1000000000000000000000000000",tether:"1000000000000000000000000000000"},storage=chrome.storage.sync;$(document).ready(function(){bindPopElements(),pageBasedOnLoads()});